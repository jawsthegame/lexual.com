MySQL Cookbook, 2nd edition.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:status: hidden

\* done

1 - Using the mysql Client Program*
===============================================================================

1.0 - Intro*
-------------------------------------------------------------------------------

done.

1.1 - Setting up a MySQL User Account*
-------------------------------------------------------------------------------

- GRANT statement
- foo
- create user & set password ::

    GRANT ALL ON mydb.* TO 'myuser'@'localhost' IDENTIFIED BY 'mypassw';

- 'localhost' should be the server hostname you will be connecting from. ::

    GRANT ALL ON mydb.* TO 'myuser'@'myserver.com' IDENTIFIED BY 'mypassw';

- need to be root, or administrative user to issues GRANT command.

1.2 - Creating a Database and a Sample Table*
-------------------------------------------------------------------------------

::

    CREATE DATABASE mydb;
    USE mydb;
    CREATE TABLE mytable (x VARCHAR(20), y INT, z INT);
    INSERT INTO mytable (x, y, z) VALUES('david', 3, 2);
    INSERT INTO mytable (x, y, z) VALUES('steve', 2, 3);
    INSERT INTO mytable (x, y, z) VALUES('steve', NULL, NULL);
    SELECT * from mytable;

- "NULL" means unknown.

1.3 - Starting and Stopping mysql*
-------------------------------------------------------------------------------

::

    -h hostname (default: localhost)
    -u user
    -p (will prompt)
    -pMYPSSWD

1.4 - Specifying Connection Parameters Using Option Files*
-------------------------------------------------------------------------------

- ~/.my.cnf
- /etc/my.cnf
- also used by mysqldump

::

    # comment
    [group_name]
    X = Y
    option_without_value

    [client]
    host        = localhost
    user        = usern
    password    = pass

    # options for mysql program itself.
    [mysql]


1.5 - Protecting Option Files from Other Users
-------------------------------------------------------------------------------

::

    chmod 600 ~/.my.cnf

    OR

    chmod go-rwx.my.cnf

1.6 - X*
-------------------------------------------------------------------------------

1.7 - X*
-------------------------------------------------------------------------------

1.8 - X*
-------------------------------------------------------------------------------

1.9 - Cancelling a Partially Entered Statement
-------------------------------------------------------------------------------

- ctrl-c OR ctrl-u

1.10 - X*
-------------------------------------------------------------------------------

1.11 - Using Auto-Completion for Database and Table Name*
-------------------------------------------------------------------------------

- tab-complete table names.

1.12 - Telling mysql to Read Statemets from A File*
-------------------------------------------------------------------------------

- redirect input ::

    mysql mydb < filename

- within mysql client ::

    SOURCE myfilename

1.13 - Telling mysql to Read Statements from Other programs*
-------------------------------------------------------------------------------

- pipe ::

    cat foo.sql | mysql mydb

    # copy db
    mysqldump mydb | mysql -h otherhost.com mydb

    generate-test-data | mysql mydb

1.14 - Entering a SQL One-Liner*
-------------------------------------------------------------------------------

::

    mysql -e "SELECT * FROM foo" mydb
    mysql -e "SELECT * FROM foo; SHOW tables;" mydb

1.15 - X*
-------------------------------------------------------------------------------

1.16 - Preventing Query Output from Scrolling off the Screen*
-------------------------------------------------------------------------------

::

    mysql --pager=/usr/bin/less
    mysql --pager # uses default system pager. $PAGER

- inside client ::

    \P # usr pager
    \n # disable

1.17 - X
-------------------------------------------------------------------------------

1.18 - Selecting Tabular or Tab-Delimited Query Output format*
-------------------------------------------------------------------------------

- tab-delimited is default
- -t/--table for tabular output.
- -B/--batch for tab-delimited.

1.19 - Specifying Arbitrary Output Column Delimiters*
-------------------------------------------------------------------------------

- mysql can't do that, pipe output to o this using sed/etc.

1.20 - Producing HTML or XML output*
-------------------------------------------------------------------------------

- -H for html
- -X for xml

1.21 - Suppressing Column Headings in Query/Output*
-------------------------------------------------------------------------------

- -ss # silent option twice
- --skip-column-names

1.22 - Making Long Output Lines More Readable*
-------------------------------------------------------------------------------

- -E/--vertical # vertical output format.

::

    SELECT * FROM foo\G

    e.g.
    *************************** 73. row ***************************
                         id: 159
                    page_id: 27
                       name: ProductJSON5
                 field_type: json
    *************************** 74. row ***************************
                         id: 160


1.23 - Controlling mysql's Verbosity Level*
-------------------------------------------------------------------------------

- -v/--verbose, -v, -vv, -vvv
- -s/--silent, -s, -ss, -sss


1.24 - Logging Interactive mysql Sessions*
-------------------------------------------------------------------------------

- tee file.
- mysql --tee=/tmp/tmp.out mydb
- will append to the file.

::

    \T tmp.out
    \t # disables.

1.25 - Creating mysql Scripts from Previously Executed Statements*
-------------------------------------------------------------------------------

- ~/.mysql_history
- edit tee file.

1.26 - Using User-Defined Variables in SQL Statements*
-------------------------------------------------------------------------------

::

    SELECT @foo := cust_id FROM bar WHERE cust_id = 'dave';
    DELETE FROM x WHERE cust_id = @foo
    DELETE FROM y WHERE cust_id = @foo

    SET @x = 3;

    SET @x = (SELECT COUNT(*) FROM foo);

- variables are case-insensitive.
- mysql specific.

1.27 - Numbering Query Output Lines.
-------------------------------------------------------------------------------

- pipe through 'cat -n'

::

    SELECT @n = 0;
    SELECT @n := @n+1 AS rownum, x, y, FROM foo;

1.28 - X*
-------------------------------------------------------------------------------

1.29 - Using mysql in shell scripts*
-------------------------------------------------------------------------------

::

    mysql mydb <<MYSQL_INPUT
    SELECT *
    FROM x
    WHERE name = 'dave';
    MYSQL_INPUT

2 - Writing MySQL-Based Programs
===============================================================================

2.0 - Intro*
-------------------------------------------------------------------------------

2.1 - Connecting, Selecting a Database, and Disconnecting*
-------------------------------------------------------------------------------

- MySQLdb module ::

    import MySQLdb
    conn = MySQLdb.connect(db = 'mydb',
                            host = 'localhost',
                            user = 'myuser',
                            passwd = 'passwd')
    conn.close()

2.2 - X*
-------------------------------------------------------------------------------

2.3 - X*
-------------------------------------------------------------------------------

2.4 - Issuing Statements and Retrieving Results
-------------------------------------------------------------------------------

- x ::
    
    cursor = conn.cursor()
    cursor.execute("UPDATE profile SET cats = cats+1 WHERE name = 'Fred'")
    print 'updated %s rows' % cursor.rowcount

    cursor = conn.cursor()
    cursor.execute("SELECT * FROM mytable")
    print 'returned %s rows' % cursor.rowcount
    while True:
        row = cursor.fetchone
        if row == None:
            break
        print 'col1: %s, col2: %s, col3: %s' % (row[0], row[1], row[2])

    # can't rewind, so fetchall() has advantages.
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM mytable")
    rows = cursor.fetchall()
    for row in rows:
        print 'col1: %s, col2: %s, col3: %s' % (row[0], row[1], row[2])
    rows[1][2] # 3rd column, 2nd row.

    cursor = conn.cursor(MySQLdb.cursors.DictCursor)
    cursor.execute("SELECT * FROM mytable")
    for row in cursor.fetchall():
        print 'col1: %s, col2: %s, col3: %s' % (row['col1',
                                                row['col2'],
                                                row['col3']
    
    

2.5 - Handling Special Characters and NULL Values in Statements*
-------------------------------------------------------------------------------

- use API's abilities, to make data safe for insertion ::

    cursor.execute("""
                    INSERT INTO table (name, birth, color, foods, cats)
                    VALUES(%s, %s, %s, %s)
                    """, ("De'Mont'", '1970-03-02', None, 'eggroll', 4))


2.6 - X
-------------------------------------------------------------------------------

2.7 - X
-------------------------------------------------------------------------------

2.8 - Techniques for Obtaining Connection Parameters*
-------------------------------------------------------------------------------

- from config ::

    # reads groups in config file.
    conn = MySQLdb.connect(db='mydb', read_default_group="foo")

    # reads groups in config file.
    conn = MySQLdb.connect(db='mydb', read_default_file="/home/fo/.my.cnf")

kk
    

2.9 - X
-------------------------------------------------------------------------------


3 - Selecting Data From Tables
===============================================================================

3.0 - Intro
-------------------------------------------------------------------------------

::

    SELECT VERSION(), DATABASE();

3.1 - Specifying Which Columns to Select
-------------------------------------------------------------------------------

::

    SELECT * FROM foo;
    SELECT x, y FROM foo;

3.2 - Specifying Which Rows to Select
-------------------------------------------------------------------------------

- WHERE clause ::

    SELECT * FROM foo WHERE name = 'david';

    SELECT * FROM foo WHERE name = 'david' AND lastname = 'letterman';

    SELECT * FROM foo WHERE name LIKE 'd%';

3.3 - Giving Better Names to Query Result Columns
-------------------------------------------------------------------------------

    SELECT DATE_FORMAT(dt, '%M %e, %Y) AS date_sent, u AS User FROM foo;

3.4 - X
-------------------------------------------------------------------------------

3.5 - Combining Columns to Construct Composite Values*
-------------------------------------------------------------------------------

- CONCAT ::

    SELECT CONCAT(user, '@', host) AS recipient FROM foo;

3.6 - X
-------------------------------------------------------------------------------

3.7 - X
-------------------------------------------------------------------------------

3.8 - X
-------------------------------------------------------------------------------

3.9 - X
-------------------------------------------------------------------------------

3.10 - X
-------------------------------------------------------------------------------

3.11 - X
-------------------------------------------------------------------------------

3.12 - X
-------------------------------------------------------------------------------

3.13 - X
-------------------------------------------------------------------------------

3.14 - X
-------------------------------------------------------------------------------

3.15 - X
-------------------------------------------------------------------------------

3.16 - X
-------------------------------------------------------------------------------

3.17 - X
-------------------------------------------------------------------------------

3.18 - X
-------------------------------------------------------------------------------


4 - Table Management
===============================================================================

4.0 - X
-------------------------------------------------------------------------------

4.1 - X
-------------------------------------------------------------------------------

4.2 - X
-------------------------------------------------------------------------------

4.3 - X
-------------------------------------------------------------------------------

4.4 - X
-------------------------------------------------------------------------------

4.5 - X
-------------------------------------------------------------------------------


5 - Working with Strings
===============================================================================

5.0 - X
-------------------------------------------------------------------------------

5.1 - X
-------------------------------------------------------------------------------

5.2 - X
-------------------------------------------------------------------------------

5.3 - X
-------------------------------------------------------------------------------

5.4 - X
-------------------------------------------------------------------------------

5.5 - X
-------------------------------------------------------------------------------

5.6 - X
-------------------------------------------------------------------------------

5.7 - X
-------------------------------------------------------------------------------

5.8 - X
-------------------------------------------------------------------------------

5.9 - X
-------------------------------------------------------------------------------

5.10 - X
-------------------------------------------------------------------------------

5.11 - X
-------------------------------------------------------------------------------

5.12 - X
-------------------------------------------------------------------------------

5.13 - X
-------------------------------------------------------------------------------

5.14 - X
-------------------------------------------------------------------------------

5.15 - X
-------------------------------------------------------------------------------

5.16 - X
-------------------------------------------------------------------------------

5.17 - X
-------------------------------------------------------------------------------

5.18 - X
-------------------------------------------------------------------------------


6 - Working with Dates and Times
===============================================================================

6.0 - X
-------------------------------------------------------------------------------

6.1 - X
-------------------------------------------------------------------------------

6.2 - X
-------------------------------------------------------------------------------

6.3 - X
-------------------------------------------------------------------------------

6.4 - X
-------------------------------------------------------------------------------

6.5 - X
-------------------------------------------------------------------------------

6.6 - X
-------------------------------------------------------------------------------

6.7 - X
-------------------------------------------------------------------------------

6.8 - X
-------------------------------------------------------------------------------

6.9 - X
-------------------------------------------------------------------------------

6.10 - X
-------------------------------------------------------------------------------

6.11 - X
-------------------------------------------------------------------------------

6.12 - X
-------------------------------------------------------------------------------

6.13 - X
-------------------------------------------------------------------------------

6.14 - X
-------------------------------------------------------------------------------

6.15 - X
-------------------------------------------------------------------------------

6.16 - X
-------------------------------------------------------------------------------

6.17 - X
-------------------------------------------------------------------------------

6.18 - X
-------------------------------------------------------------------------------

6.19 - X
-------------------------------------------------------------------------------

6.20 - X
-------------------------------------------------------------------------------

6.21 - X
-------------------------------------------------------------------------------


7 - Sorting Query Results
===============================================================================

7.0 - X
-------------------------------------------------------------------------------

7.1 - X
-------------------------------------------------------------------------------

7.2 - X
-------------------------------------------------------------------------------

7.3 - X
-------------------------------------------------------------------------------

7.4 - X
-------------------------------------------------------------------------------

7.5 - X
-------------------------------------------------------------------------------

7.6 - X
-------------------------------------------------------------------------------

7.7 - X
-------------------------------------------------------------------------------

7.8 - X
-------------------------------------------------------------------------------

7.9 - X
-------------------------------------------------------------------------------

7.10 - X
-------------------------------------------------------------------------------

7.11 - X
-------------------------------------------------------------------------------

7.12 - X
-------------------------------------------------------------------------------

7.13 - X
-------------------------------------------------------------------------------

7.14 - X
-------------------------------------------------------------------------------

7.15 - X
-------------------------------------------------------------------------------

7.16 - X
-------------------------------------------------------------------------------


8 - Generating Summaries
===============================================================================

8.0 - X
-------------------------------------------------------------------------------

8.1 - X
-------------------------------------------------------------------------------

8.2 - X
-------------------------------------------------------------------------------

8.3 - X
-------------------------------------------------------------------------------

8.4 - X
-------------------------------------------------------------------------------

8.5 - X
-------------------------------------------------------------------------------

8.6 - X
-------------------------------------------------------------------------------

8.7 - X
-------------------------------------------------------------------------------

8.8 - X
-------------------------------------------------------------------------------

8.9 - X
-------------------------------------------------------------------------------

8.10 - X
-------------------------------------------------------------------------------

8.11 - X
-------------------------------------------------------------------------------

8.12 - X
-------------------------------------------------------------------------------

8.13 - X
-------------------------------------------------------------------------------

8.14 - X
-------------------------------------------------------------------------------

8.15 - X
-------------------------------------------------------------------------------

8.16 - X
-------------------------------------------------------------------------------

8.17 - X
-------------------------------------------------------------------------------


9 - Obtaining and Using Metadata
===============================================================================

9.0 - X
-------------------------------------------------------------------------------

9.1 - X
-------------------------------------------------------------------------------

9.2 - X
-------------------------------------------------------------------------------

9.3 - X
-------------------------------------------------------------------------------

9.4 - X
-------------------------------------------------------------------------------

9.5 - X
-------------------------------------------------------------------------------

9.6 - X
-------------------------------------------------------------------------------

9.7 - X
-------------------------------------------------------------------------------

9.8 - X
-------------------------------------------------------------------------------

9.9 - X
-------------------------------------------------------------------------------

9.10 - X
-------------------------------------------------------------------------------

9.11 - X
-------------------------------------------------------------------------------

9.12 - X
-------------------------------------------------------------------------------

9.13 - X
-------------------------------------------------------------------------------


10 - Importing and Exporting Data
===============================================================================

10.0 - X
-------------------------------------------------------------------------------

10.1 - X
-------------------------------------------------------------------------------

10.2 - X
-------------------------------------------------------------------------------

10.3 - X
-------------------------------------------------------------------------------

10.4 - X
-------------------------------------------------------------------------------

10.5 - X
-------------------------------------------------------------------------------

10.6 - X
-------------------------------------------------------------------------------

10.7 - X
-------------------------------------------------------------------------------

10.8 - X
-------------------------------------------------------------------------------

10.9 - X
-------------------------------------------------------------------------------

10.10 - X
-------------------------------------------------------------------------------

10.11 - X
-------------------------------------------------------------------------------

10.12 - X
-------------------------------------------------------------------------------

10.13 - X
-------------------------------------------------------------------------------

10.14 - X
-------------------------------------------------------------------------------

10.15 - X
-------------------------------------------------------------------------------

10.16 - X
-------------------------------------------------------------------------------

10.17 - X
-------------------------------------------------------------------------------

10.18 - X
-------------------------------------------------------------------------------

10.19 - X
-------------------------------------------------------------------------------

10.20 - X
-------------------------------------------------------------------------------

10.21 - X
-------------------------------------------------------------------------------

10.22 - X
-------------------------------------------------------------------------------

10.23 - X
-------------------------------------------------------------------------------

10.24 - X
-------------------------------------------------------------------------------

10.25 - X
-------------------------------------------------------------------------------

10.26 - X
-------------------------------------------------------------------------------

10.27 - X
-------------------------------------------------------------------------------

10.28 - X
-------------------------------------------------------------------------------

10.29 - X
-------------------------------------------------------------------------------

10.30 - X
-------------------------------------------------------------------------------

10.31 - X
-------------------------------------------------------------------------------

10.32 - X
-------------------------------------------------------------------------------

10.33 - X
-------------------------------------------------------------------------------

10.34 - X
-------------------------------------------------------------------------------

10.35 - X
-------------------------------------------------------------------------------

10.36 - X
-------------------------------------------------------------------------------

10.37 - X
-------------------------------------------------------------------------------

10.38 - X
-------------------------------------------------------------------------------

10.39 - X
-------------------------------------------------------------------------------

10.40 - X
-------------------------------------------------------------------------------

10.41 - X
-------------------------------------------------------------------------------


11 - Generating and Using Sequences
===============================================================================

11.0 - X
-------------------------------------------------------------------------------

11.1 - X
-------------------------------------------------------------------------------

11.2 - X
-------------------------------------------------------------------------------

11.3 - X
-------------------------------------------------------------------------------

11.4 - X
-------------------------------------------------------------------------------

11.5 - X
-------------------------------------------------------------------------------

11.6 - X
-------------------------------------------------------------------------------

11.7 - X
-------------------------------------------------------------------------------

11.8 - X
-------------------------------------------------------------------------------

11.9 - X
-------------------------------------------------------------------------------

11.10 - X
-------------------------------------------------------------------------------

11.11 - X
-------------------------------------------------------------------------------

11.12 - X
-------------------------------------------------------------------------------

11.13 - X
-------------------------------------------------------------------------------

11.14 - X
-------------------------------------------------------------------------------

11.15 - X
-------------------------------------------------------------------------------

11.16 - X
-------------------------------------------------------------------------------


12 - Using Multiple Tables
===============================================================================

12.0 - X
-------------------------------------------------------------------------------

12.1 - X
-------------------------------------------------------------------------------

12.2 - X
-------------------------------------------------------------------------------

12.3 - X
-------------------------------------------------------------------------------

12.4 - X
-------------------------------------------------------------------------------

12.5 - X
-------------------------------------------------------------------------------

12.6 - X
-------------------------------------------------------------------------------

12.7 - X
-------------------------------------------------------------------------------

12.8 - X
-------------------------------------------------------------------------------

12.9 - X
-------------------------------------------------------------------------------

12.10 - X
-------------------------------------------------------------------------------

12.11 - X
-------------------------------------------------------------------------------

12.12 - X
-------------------------------------------------------------------------------

12.13 - X
-------------------------------------------------------------------------------

12.14 - X
-------------------------------------------------------------------------------

12.15 - X
-------------------------------------------------------------------------------

12.16 - X
-------------------------------------------------------------------------------


13 - Statistical Techniques
===============================================================================

13.0 - X
-------------------------------------------------------------------------------

13.1 - X
-------------------------------------------------------------------------------

13.2 - X
-------------------------------------------------------------------------------

13.3 - X
-------------------------------------------------------------------------------

13.4 - X
-------------------------------------------------------------------------------

13.5 - X
-------------------------------------------------------------------------------

13.6 - X
-------------------------------------------------------------------------------

13.7 - X
-------------------------------------------------------------------------------

13.8 - X
-------------------------------------------------------------------------------

13.9 - X
-------------------------------------------------------------------------------


14 - Handling Duplicates
===============================================================================

14.0 - X
-------------------------------------------------------------------------------

14.1 - X
-------------------------------------------------------------------------------

14.2 - X
-------------------------------------------------------------------------------

14.3 - X
-------------------------------------------------------------------------------

14.4 - X
-------------------------------------------------------------------------------

14.5 - X
-------------------------------------------------------------------------------


15 - Performing Transactions
===============================================================================

15.0 - X
-------------------------------------------------------------------------------

15.1 - X
-------------------------------------------------------------------------------

15.2 - X
-------------------------------------------------------------------------------

15.3 - X
-------------------------------------------------------------------------------

15.4 - X
-------------------------------------------------------------------------------

15.5 - X
-------------------------------------------------------------------------------

15.6 - X
-------------------------------------------------------------------------------

15.7 - X
-------------------------------------------------------------------------------

15.8 - X
-------------------------------------------------------------------------------

15.9 - X
-------------------------------------------------------------------------------


16 - Using Stored Routines, Triggers, and Events
===============================================================================

16.0 - X
-------------------------------------------------------------------------------

16.1 - X
-------------------------------------------------------------------------------

16.2 - X
-------------------------------------------------------------------------------

16.3 - X
-------------------------------------------------------------------------------

16.4 - X
-------------------------------------------------------------------------------

16.5 - X
-------------------------------------------------------------------------------

16.6 - X
-------------------------------------------------------------------------------

16.7 - X
-------------------------------------------------------------------------------


17 - Introductino to MySQL on the Web
===============================================================================

17.0 - X
-------------------------------------------------------------------------------

17.1 - X
-------------------------------------------------------------------------------

17.2 - X
-------------------------------------------------------------------------------

17.3 - X
-------------------------------------------------------------------------------

17.4 - X
-------------------------------------------------------------------------------


18 - Incorporating Query Results into Web Pages
===============================================================================

18.0 - X
-------------------------------------------------------------------------------

18.1 - X
-------------------------------------------------------------------------------

18.2 - X
-------------------------------------------------------------------------------

18.3 - X
-------------------------------------------------------------------------------

18.4 - X
-------------------------------------------------------------------------------

18.5 - X
-------------------------------------------------------------------------------

18.6 - X
-------------------------------------------------------------------------------

18.7 - X
-------------------------------------------------------------------------------

18.8 - X
-------------------------------------------------------------------------------

18.9 - X
-------------------------------------------------------------------------------

18.10 - X
-------------------------------------------------------------------------------


19 - Processing Web Input with MySL
===============================================================================

19.0 - X
-------------------------------------------------------------------------------

19.1 - X
-------------------------------------------------------------------------------

19.2 - X
-------------------------------------------------------------------------------

19.3 - X
-------------------------------------------------------------------------------

19.4 - X
-------------------------------------------------------------------------------

19.5 - X
-------------------------------------------------------------------------------

19.6 - X
-------------------------------------------------------------------------------

19.7 - X
-------------------------------------------------------------------------------

19.8 - X
-------------------------------------------------------------------------------

19.9 - X
-------------------------------------------------------------------------------

19.10 - X
-------------------------------------------------------------------------------

19.11 - X
-------------------------------------------------------------------------------

19.12 - X
-------------------------------------------------------------------------------

19.13 - X
-------------------------------------------------------------------------------

19.14 - X
-------------------------------------------------------------------------------


20 - Using MySQL-Based Web Session Management
===============================================================================

20.0 - X
-------------------------------------------------------------------------------

20.1 - X
-------------------------------------------------------------------------------

20.2 - X
-------------------------------------------------------------------------------

20.3 - X
-------------------------------------------------------------------------------

20.4 - X
-------------------------------------------------------------------------------


